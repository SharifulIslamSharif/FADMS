@{
    ViewData["Title"] = "ArmPurchase";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="row">


        <div class="col-md-12">
            <div class="card" style="width: 100%;">
                <div class="card-body">
                    @*<h5 class="card-title" style="color: black">@Model.armPurchaseInfoLn.title</h5>*@
                    <h5 class="card-title" style="color: black">আগ্নেয়াস্ত্র  ক্রয় তথ্য</h5>
                    <hr />
                    <div class="container">
                        <form asp-area="License" asp-controller="ArmPurchase" asp-action="Index" method="post" enctype="multipart/form-data" data-parsley-validate="parsley">
                            <div asp-validation-summary="All" class="text-danger"></div>
                            <input type="hidden" name="id" id="id">
                            <div class="row">
                                <div class="col-6">
                                    <div class="form-group row">
                                        @*<label for="armTypeId" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.licenseN</label>*@
                                        <label for="armTypeId" class="col-sm-4 col-form-label">উৎসের লাইসেন্স নং </label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="licenseNo" name="licenseNo" data-parsley-required="true" />
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        @*<label for="armTypeId" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.dealerName</label>*@
                                        <label for="armTypeId" class="col-sm-4 col-form-label">উৎসের নাম</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="dealerName" name="dealerName" data-parsley-required="true" />
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        @*<label for="armTypeId" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.issueDate</label>*@
                                        <label for="armTypeId" class="col-sm-4 col-form-label">প্রদানের তারিখ </label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="issueDate" name="issueDate" data-parsley-required="true" />
                                        </div>

                                    </div>
                                    <div class="form-group row">
                                        @*<label for="armTypeId" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.expiryDate</label>*@
                                        <label for="armTypeId" class="col-sm-4 col-form-label">মেয়াদ শেষ হওয়ার তারিখ</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="expiryDate" name="expiryDate" data-parsley-required="true" />
                                        </div>

                                    </div>


                                </div>
                                <div class="col-6">
                                    <div class="form-group row">
                                        @*<label for="armModelId" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.address</label>*@
                                        <label for="armModelId" class="col-sm-4 col-form-label">ঠিকানা</label>
                                        <div class="col-sm-8">
                                            <textarea rows="5" class="form-control" id="address" name="address" data-parsley-required="true"></textarea>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        @*<label for="quantity" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.phone</label>*@
                                        <label for="quantity" class="col-sm-4 col-form-label">মোবাইল নাম্বার</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="phone" name="phone" data-parsley-required="true" />
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </form>
                    </div>

                    <hr />
                    <div class="container">
                        <div asp-validation-summary="All" class="text-danger"></div>
                        <div class="row">
                            @*<h6 class="card-title pull-left col-md-12" style="color: black;margin-left:0px;padding-left:0px;"><u>@Model.armPurchaseInfoLn.armsInfo</u></h6>*@
                            <h6 class="card-title pull-left col-md-12" style="color: black;margin-left:0px;padding-left:0px;"><u>আগ্নেয়াস্ত্রের  তথ্য</u></h6>
                            <div class="col-6">
                                <div class="form-group row">
                                    @*<label for="armTypeId" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.armsType</label>*@
                                    <label for="armTypeId" class="col-sm-4 col-form-label">আগ্নেয়াস্ত্রের  ধরন</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" id="ArmType" name="ArmType" data-parsley-required="true">
                                            <option>-নির্বাচন করুন-</option>
                                            @*@foreach (var data in Model.getArmsType)
                                            {
                                                <option value="@data.Id">@data.ArmTypeName</option>
                                            }*@
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    @*<label for="purchaseDate" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.quantity</label>*@
                                    <label for="purchaseDate" class="col-sm-4 col-form-label">পরিমান</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="quantity" name="quantity" data-parsley-required="true" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    @*<label for="manufactureId" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.manufacturer</label>*@
                                    <label for="manufactureId" class="col-sm-4 col-form-label"> উৎপাদকের নাম</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" id="ManufactureInfo" name="ManufactureInfo" data-parsley-required="true">
                                            <option>-নির্বাচন করুন-</option>
                                            @*@foreach (var data in Model.getManufactureInfos)
                                            {
                                                <option value="@data.Id">@data.ManufactureName</option>
                                            }*@

                                        </select>
                                    </div>

                                </div>

                            </div>
                            <div class="col-6">
                                <div class="form-group row">
                                    @*<label for="armModelId" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.model</label>*@
                                    <label for="armModelId" class="col-sm-4 col-form-label">মডেল</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" id="ArmsModel" name="ArmsModel" data-parsley-required="true"></select>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    @*<label for="quantity" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.armIdNo</label>*@
                                    <label for="quantity" class="col-sm-4 col-form-label"> আগ্নেয়াস্ত্রের  পরিচিতি নং</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="SerialNo" name="SerialNo" data-parsley-required="true" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    @*<label for="purchaseDate" class="col-sm-4 col-form-label">@Model.armPurchaseInfoLn.ammunition</label>*@
                                    <label for="purchaseDate" class="col-sm-4 col-form-label">গুলি</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="ammunition" name="ammunition" data-parsley-required="true" />
                                    </div>
                                </div>
                                <button onclick="AddArmsInfo()" value="Add" title="Add" class="btn btn-success btn-sm ml-1" style="float:right; margin-top:5px;"><i class="fas fa-plus fa-w-1"></i></button>&nbsp;&nbsp;
                                <button onclick="Refresh()" value="Refresh" title="Refresh" class="btn btn-success btn-sm ml-1" style="float:right; margin-top:5px;"><i class="fas fa-circle-notch"></i></button>

                                @*<button type="submit" value="Submit" class="btn btn-success btn-lg" style="float:right; margin-top:5px;"><i class="fas fa-save"></i></button>*@
                            </div>
                        </div>
                        <div style="height:10px"></div>
                        <div class="row">

                            <div class="col-md-12">
                                @*<h6 style="color: black;margin-left:0px;padding-left:0px;"><u><b>@Model.armPurchaseInfoLn.listOfArmsInfo</b></u></h6>*@
                                <h6 style="color: black;margin-left:0px;padding-left:0px;"><u><b>নির্বাচিত আগ্নেয়াস্ত্রের  তালিকা</b></u></h6>
                                <table class="table table-sm table-bordered table-striped" id="tblArmsInfo">
                                    <thead style="width:100%">
                                        <tr>
                                            <th width="25%">আগ্নেয়াস্ত্রের  ধরণ </th>
                                            <th width="15%">পরিমাণ</th>
                                            <th width="20%">গোলাবারুদ</th>
                                            <th width="20%">মডেল </th>
                                            <th width="25%">প্রস্তুতকারক</th>
                                            <th width="15%">-</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <button value="Submit" class="btn btn-success btn-sm mr-3" style="float:right; margin-top:5px;"><i class="fas fa-save"></i></button>
                </div>

                <div class="card-body">
                    @*<h5 class="card-title" style="color: black">@Model.armPurchaseInfoLn.title </h5>*@
                    <h5 class="card-title" style="color: black">আগ্নেয়াস্ত্র  ক্রয় তথ্য</h5>
                    <hr />
                </div>




                <div class="col-12">
                    <table id="tblDealerInfo" class="table table-striped table-sm table-bordered">
                        <thead>
                            <tr>
                                <th>ডিলারের নাম</th>
                                <th>আগ্নেয়াস্ত্রের  ধরণ </th>
                                <th>মডেল </th>
                                <th>প্রস্তুতকারক</th>
                                <th>আগ্নেয়াস্ত্রের  আইডি নং</th>
                                <th>ক্রয় তারিখ </th>
                                <th>প্রক্রিয়া </th>
                            </tr>
                        </thead>
                        <tbody>
                            @*@foreach (var data in Model.GetarmPurchaseInfobydealerId)
                            {*@
                            <tr>
                                <td>NameOfOrganization</td>
                                <td>ArmTypeName</td>

                                <td>modelName</td>
                                <td>ManufactureName</td>
                                <td>SerialNo</td>
                                <td>PurchaseDate</td>
                                <td>
                                    <a href="javascript:void(0)" class="btn btn-success" onclick="Edit()"><i class="fa fa-edit"></i></a>
                                    <a href="javascript:void(0)" class="btn btn-danger" onclick="Delete()"><i class="fa fa-trash"></i></a>
                                </td>
                            </tr>
                            @*}*@

                        </tbody>
                    </table>
                </div>






            </div>
        </div>
    </div>
</div>
@section Scripts{
    <script src="~/js/jquery.autocomplete.js" type="text/javascript"></script>
    <script src="~/js/jquery.autocomplete.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#issueDate').datepicker({
                uiLibrary: 'bootstrap4'
            });
            $('#expiryDate').datepicker({
                uiLibrary: 'bootstrap4'
            });
            $("#ArmTypeId").change(function () {
                var id = $(this).val();
                Common.Ajax('GET', '/License/ArmPurchase/GetArmModel/' + id, [], 'json', ajaxGetArmModel);
            });

            LoadLicenseList();
        })

        var index = 0;
        function AddArmsInfo() {
            let ArmTypeId = $('#ArmTypeId option:selected').text();
            let ManufactureInfoId = $('#ManufactureInfoId option:selected').text();
            let ammunition = $('#ammunition').val();
            let quantity = $('#quantity').val();
            let ArmsModelId = $('#ArmsModelId option:selected').text();

            var dtTable = $("#tblArmsInfo");
            var tableBody = dtTable.find('tbody');
            var trHtml = '<tr id=' + index + '>' +
                '<td>' + ArmTypeId + '</td>' +
                '<td>' + quantity + '</td>' +
                '<td>' + ManufactureInfoId+'</td>' +
                '<td>' + ammunition + '</td>' +
                '<td>' + ArmsModelId + '</td>' +
                '<td><a href="javascript:void(0)"style="background-color:red;border-color:red" data-toggle="tooltip" title="Delete" class="btn btn-danger btn-xs" onclick="Delete(' + index + ')"><i class="fa fa-trash"></i></a></td>' +

                '</tr>';

            tableBody.append(trHtml);
            index = index + 1;
            Refresh();
        }

        function Delete(index) {
            $("#" + index).remove();
            return false;
        }

        function Refresh() {
            $('#ArmTypeId').val('');
            $('#ManufactureInfoId').val('');
            $('#ammunition').val('');
            $('#ArmsModelId').val('');
            $('#SerialNo').val('');
            $('#quantity').val('');
        }

        function LoadLicenseList() {
            $("#licenseNo").val('');
            var lstLicense = [];
            $.ajax({
                contentType: "application/json; charset=utf-8",
                url: '@Url.Action("GetLicenseList", "ArmPurchase","http")',
                type: "GET",
                dataType: "json",
                async: true,
                data: {},
                success: function (records) {
                    $.each(records, function (id, option) {
                        var obj = new Object();
                        obj.key = option.Id;
                        obj.value = option.licenseNumber;
                        obj.name = option.nameBangla;
                        lstLicense[lstLicense.length] = obj;
                    });
                },
                failure: function () {
                    $.alert.open("error", "Failed!");
                }
            });
            $('#licenseNo').autocomplete({
                source: lstLicense,
                select: function (event, ui) {
                    $("#licenseNo").val(ui.item.value);
                    $("#dealerName").val(ui.item.name);
                }
            });

        }

        function Edit(Id, ManufactureInfoId, ArmTypeId, ArmsModelId, PurchaseDate,SerialNo) {


            $("#id").val(Id);
            $("#ManufactureInfoId").val(ManufactureInfoId);

            $("#ArmTypeId").val(ArmTypeId);
            Common.Ajax('GET', '/License/ArmPurchase/GetArmModel/' + ArmTypeId, [], 'json', ajaxGetArmModel);
           // alert(ArmsModelId);


            //alert($("#ArmsModelId").val(ArmsModelId));
            $("#purchaseDate").val(PurchaseDate);
           // alert(SerialNo+'-'+PurchaseDate)
            $("#SerialNo").val(SerialNo);
            $("#ArmsModelId").val(ArmsModelId);

        }
        function ajaxGetArmModel(response) {

            var options = '<option value="">Select</option>';
            $.each(response, function (i, item) {
                options += '<option value="' + item.Id + '">' + item.modelName + '</option>';
            });
            $('#ArmsModelId').empty();
            $('#ArmsModelId').append(options);
        }

    </script>

}
<style>
    .ui-autocomplete {
        cursor: pointer;
        height: 400px;
        width: 300px;
        overflow-y: scroll;
        background-color: white;
        color: rgb(0,188,212);
        z-index: 1050;
        /*outline-style:outset;*/
    }
</style>

