@model UserListViewModel
@{
    ViewData["Title"] = "User List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<style>
    select[readonly] {
        background: #eee;
        pointer-events: none;
        touch-action: none;
    }
</style>
<div class="col-12" style="width:98%">
    <div class="row clearfix">
        <div class="col-12">
            <div class="card mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header  d-flex flex-row align-items-center justify-content-between">
                    <div class="col-md-6">
                        <h5 class="card-title bold" style="color: black">ইউজার তালিকা </h5>
                    </div>
                    <div class="col-md-5">
                        @*<a class="btn btn-success btn-sm ml-2" id="backBtn" style="float:right; color:white">&nbsp; &nbsp; Back &nbsp; &nbsp;</a>*@
                        <button type="button" class="btn btn-default btn-sm" style="width:100px;background-color:#024972;color:white;float:right; width:40%" onclick="location.href='/Auth/Account/CreateUser'">নতুন ইউজার নিবন্ধন করুন</button>
                    </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <table class="table table-striped table-bordered" id="NomineeTable">
                        <thead>
                            <tr>
                                <th>ইউজার আইডি</th>
                                <th style="width:15%">ইউজার নাম</th>
                                <th>ইমেল</th>
                                <th>মোবাইল </th>
                                @*<th>বিপি নম্বর  </th>
                                <th>র‍্যাংক</th>*@
                                <th>ইউজার রোল</th>
                                @*<th>বিভাগ</th>*@
                                <th>ইউজার ঠিকানা</th>
                                <th style="width:10%">প্রক্রিয়া </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var data in Model.aspNetUsersViewModels.OrderByDescending(x => x.createdAt))
                            {
                            <tr>
                                <td>@data.UserName</td>
                                <td style="width:15%">@data.PersonName</td>
                                <td>@data.Email</td>
                                <td>@data.mobileNo</td>
                                @*<td>@data.BpNumber</td>
                                <td>@data.rank</td>*@
                                <td>@data.roleName</td>
                                @*<td>@data.DivisionName</td>*@
                                <td>@data.DistrictName, @data.ThanaName </td>
                                <td style="width:10%">
                                    <a class="btn btn-info" title="Edit" onclick="Edit('@data.aspnetId','@data.UserName','@data.BpNumber','@data.rank','@data.mobileNo','@data.PersonName','@data.Email','@data.roleName')" href="javascript:void(0)"><i class="fa fa-edit"></i></a>
                                    <a class="btn btn-success" title="Reset Password" onclick="SetEmpCode('@data.UserName','@data.aspnetId')" href="#" data-toggle="modal" data-target="#changePasswordModal"><i class="fa fa-key"></i></a>
                                    @*<a class="btn btn-danger" title="Delete User" onclick="Remove('@data.aspnetId','@data.UserName')" href="#"><i class="fa fa-trash-alt"></i></a>*@
                                    @if (data.isActive == 1)
                                    {
                                        <a class="btn btn-danger" title="InActive User" onclick="InActive('@data.aspnetId')" href="#"><i class="fa fa-times"></i></a>
                                    }
                                    else
                                    {
                                        <a class="btn btn-success" title="Active User" onclick="Active('@data.aspnetId')" href="#"><i class="fa fa-check"></i></a>
                                    }
                                </td>
                            </tr>
                            }

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">

                <h5 class="modal-title" id="exampleModalLabel">পাসওয়ার্ড রিসেট করুন</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body" style="margin-left: 20px;">
                <form asp-area="Auth" asp-controller="Account" asp-action="ResetPassword" method="post" data-parsley-validate="parsley" autocomplete="on">

                    <div asp-validation-summary="All" class="text-danger"></div>


                    <div class="form-group row" style="display:none;">
                        <label for="Name" class="col-sm-2 col-form-label">নাম</label>
                        <div class="col-sm-10">
                            <input type="hidden" class="form-control" id="Name" name="Name" data-parsley-required="true" data-parsley-maxlength="100">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="Email" class="col-sm-4 col-form-label">ব্যবহারকারীর নাম</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="userName" name="userName" value="" readonly>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="Password" class="col-sm-4 col-form-label">নতুন পাসওয়ার্ড </label>
                        <div class="col-sm-8">
                            <input type="password" class="form-control" id="Password" name="Password" data-parsley-required="true" data-parsley-maxlength="20" data-parsley-equalto="#ConfirmPassword">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="ConfirmPassword" class="col-sm-4 col-form-label">পাসওয়ার্ড নিশ্চিত করুন</label>
                        <div class="col-sm-8">
                            <input type="password" class="form-control" id="ConfirmPassword" name="ConfirmPassword" data-parsley-required="true" data-parsley-maxlength="20" data-parsley-equalto="#Password">
                        </div>
                    </div>
                    <input type="hidden" name="userId" id="userId" value="" />

                    <hr />
                    <button data-toggle="tooltip" title="Save" type="submit" value="Submit" class="btn btn-success btn-sm" style="float:right; margin-top:5px;"><i class="fas fa-save"></i> জমা দিন</button>
                </form>
            </div>
        </div>
    </div>
</div>
@*Edit Modal*@
<div class="modal fade" id="ValidatModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="width:1040px;">
            <div class="modal-header">
                <label class="modal-title pull-left" id="myModalLabel" style="color:rgb(9, 7, 161);font-size:1em;">
                    ব্যবহারকারী ফর্ম <span id="UserId"></span>
                </label>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <br />
            </div>
            <div class="modal-body" style="margin-left: 20px;">
                <form asp-area="Auth" asp-controller="Account" asp-action="EditRole" method="post" data-parsley-validate="parsley">
                    <div asp-validation-summary="All" class="text-danger"></div>
                    <div class="row text-center">
                        <div class="col-sm-8">

                            @*<div class="form-group row">
                        <label for="employeeCode" class="col-sm-4 col-form-label"> Employee Code <span style="color:red">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="employeeCode" value="" name="employeeCode" readonly>
                            <input type="hidden" id="aspUserId" value="" name="aspUserId">
                            <input type="hidden" id="employeeId" value="" name="employeeId">
                            <input type="hidden" id="EuserName" value="" name="EuserName">
                            <input type="hidden" id="PreRoleId" value="" name="PreRoleId">

                        </div>
                    </div>*@

                            <div class="form-group row">
                                <label for="name" class="col-sm-4 col-form-label">ইউজার আইডি<span style="color:red">*</span></label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" name="userName" id="userName1" readonly>
                                    <input type="hidden" id="userId1" name="userId">
                                    <input type="hidden" id="PreRoleId" name="PreRoleId">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="bpNumber" class="col-sm-4 col-form-label">ইউজার নাম<span style="color:red">*</span></label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" name="personname" id="personname">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="bpNumber" class="col-sm-4 col-form-label">বিপি নম্বর<span style="color:red">*</span></label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" name="bpnumber" id="bpNumber">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="rank" class="col-sm-4 col-form-label">র‍্যাংক<span style="color:red">*</span></label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" name="Rank" id="ranks">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="PhoneNumber" class="col-sm-4 col-form-label">মোবাইল নং<span style="color:red">*</span></label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" name="phonenumber" id="PhoneNumber">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="leaveFrom" class="col-sm-4 col-form-label">ইমেল<span style="color:red">*</span></label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" name="email" id="email">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="roleId" class="col-sm-4 col-form-label">ভূমিকা <span style="color:red">*</span></label>
                                <div class="col-sm-8">
                                    <select type="text" class="form-control" name="RoleId" id="RoleId" readonly>
                                        <option value="0" selected="selected">ব্যবহারকারীর ভূমিকা নির্বাচন করুন</option>
                                        @*@foreach (var data in Model.userRoles)*@
                                        @foreach (var data in Model.userRoles)
                                        {
                                            <option value="@data.RoleName">@data.RoleName</option>
                                        }
                                    </select>
                                </div>
                            </div>

                        </div>
                    </div>
                    <hr>
                    <button type="submit" value="Submit" class="btn btn-success btn-lg" style="float:right; margin-top:5px;"><i class="fas fa-save"></i></button>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-sm" data-dismiss="modal"><i class="fa fa-arrow-left"></i> পেছনে যান </button>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>
        $(document).ready(function () {
            $('#NomineeTable').DataTable();

            //Common.Ajax('GET', '/global/api/getEmployeeInfoByOrg/', [], 'json', ajaxEmployeeList, false);
        });

        function ajaxEmployeeList(response) {
            console.log(response);
            var GetEmployeeList = [];
            $.each(response, function (id, option) {
                var obj = new Object();
                obj.key = option.Id;
                obj.value = option.employeeCode + ' - ' + option.nameEnglish;
                obj.name = option.nameEnglish;
                obj.designation = option.designation;
                obj.orgType = option.orgType;
                obj.nationalID = option.nationalID;
                GetEmployeeList[GetEmployeeList.length] = obj;
            });
            $('#employeeCode').autocomplete({
                source: GetEmployeeList,
                select: function (event, ui) {
                    $("#name").val(ui.item.name);
                    $("#employeeId").val(ui.item.key);
                    $("#designation").val(ui.item.designation);
                }
            });
        }

        function SetEmpCode(userName, uid) {
            $("#userName").val(userName);
            $("#Name").val(userName);
        }

        function Edit(uid, name, bpNumber, rank, PhoneNumber, personname, email, role) {
            //alert(name);
            //$("#UserId").val(Id);
            $("#userName1").val(name);
            $("#bpNumber").val(bpNumber);
            $("#ranks").val(rank);
            $("#PhoneNumber").val(PhoneNumber);
            $("#userId1").val(uid);
            $("#PreRoleId").val(role);
            $("#personname").val(personname);
            //$("#employeeCode").val(empCode);
            //$("#name").val(empName);
            //$("#designation").val(designation);
            $("#RoleId").val(role);
            $("#email").val(email);
            $('#ValidatModal').modal('show');

        }

        function Active(index) {
            swal({
                title: 'Are you sure?', text: 'Do you want to Active this User!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, Active it!'
            }).then(function () {
                window.location.href = "/Auth/Account/UpdateStatus?Id=" + index + "&status=1";
                //swal('', 'Updated Successfully!', 'success')
            });
            //return false;
            window.location.reload = true;
        }

        function InActive(index) {
            swal({
                title: 'Are you sure?', text: 'Do you want to In Active this User!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, In Active it!'
            }).then(function () {
                //window.location.href = "/Auth/Account/UpdateStatus?Id=" + index + "&status=0";
                window.location.href = "/Auth/Account/UpdateStatus?Id=" + index + "&status=0";
                swal('', 'Updated Successfully!', 'success')
            });
            window.location.reload = true;
        }

        function Remove(index, user) {
            if (user == '@User.Identity.Name') {
                swal('Warning', 'Cannot Delete Current User!', 'warning');
                return false;
            }
            swal({
                title: 'Are you sure?', text: 'Do you want to delete this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, delete it!'
            }).then(function () {
                window.location.href = "/Auth/Account/Delete?Id=" + index;
                swal('', 'Deleted Successfully!', 'success')
            });
            window.location.reload = true;
        }
    </script>
}
