@model RegisterViewModel
@{
    ViewData["Title"] = "CreateUser";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<form class="user" asp-action="Register" asp-route-returnUrl="@ViewData["ReturnUrl"]" id="FormId" method="post">
    <div class="col-12" style="width:98%; background-color:white">
        <div class="row clearfix">
            <div class="col-12">
                <div class="card mb-4" style="background-color:whitesmoke">
                    <!-- Card Header - Dropdown -->
                    <div class="card-header  d-flex flex-row align-items-center justify-content-between">
                        <div class="col-md-6">
                            <h5 class="card-title bold" style="color: black">ইউজার নিবন্ধন </h5>
                        </div>
                        <div class="col-md-5">
                            @*<a class="btn btn-success btn-sm ml-2" id="backBtn" style="float:right; color:white">&nbsp; &nbsp; Back &nbsp; &nbsp;</a>*@
                            <button type="button" class="btn btn-default btn-sm" style="width:100px;background-color:#024972;color:white;float:right; width:40%" onclick="location.href='/Auth/Account/UserList'">ইউজার তালিকা</button>
                        </div>
                    </div>
                    <from data-parsley-validate="parsley">

                        <div asp-validation-summary="All" class="text-danger"></div>
                        <div class="row">

                            <div class="col-2"></div>
                            <div class="col-8">
                                <div class="form-group row">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">ইউজার নাম<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="UName1" placeholder="নাম" name="personname" data-parsley-required="true">
                                        <input type="hidden" id="EmpCode" name="EmpCode">
                                        <input type="hidden" id="RoleName" name="RoleName">
                                    </div>

                                </div>
                                @*<div class="form-group row">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">বিপি নম্বর<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="text" data-parsley-required="true" class="form-control " id="bpNumber" placeholder="বিপি নম্বর" name="bpNumber">

                                    </div>
                                </div>*@
                                @*<div class="form-group row">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">র‍্যাংক<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="text" data-parsley-required="true" class="form-control " id="rank" placeholder="রাঙ্ক" name="rank">

                                    </div>
                                </div>*@
                                <div class="form-group row">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">মোবাইল নং<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="text" data-parsley-required="true" class="form-control " id="" placeholder="মোবাইল নং" name="PhoneNumber">

                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">ই-মেইল<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="email" data-parsley-required="true" class="form-control " id="Email" @*onchange="DuplicateEmail()" *@ placeholder="ই-মেইল ঠিকানা" name="Email">

                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">ইউজার রোল নির্বাচন করুন<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <select id="RoleId" name="RoleId" class="form-control" data-parsley-required="true">
                                            <option value="0" selected="selected">ইউজার রোল নির্বাচন করুন</option>
                                            @foreach (var data in Model.userRoles.Where(x => x.RoleName != "General User"))
                                            {
                                                <option value="@data.RoleId">@data.RoleName</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row" style="display:none" id="divDealer">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">ডিলার নির্বাচন করুন<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <select id="dealerId" name="dealerId" class="form-control">
                                            <option value="0" selected="selected">ডিলার নির্বাচন করুন</option>
                                            @foreach (var data in Model.dealers)
                                            {
                                                <option value="@data.Id">@data.dealerName</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                               
                                <div class="form-group row disAll">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">বিভাগ নির্বাচন করুন<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <select id="divisionId" name="divisionId" class="form-control">
                                            <option value="0" selected="selected">বিভাগ নির্বাচন করুন</option>
                                            @foreach (var data in Model.vw_divisions)
                                            {
                                                <option value="@data.Id">@data.divisionNameBn</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row disAll">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">জেলা নির্বাচন করুন<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <select id="districtId" name="districtId" class="form-control">
                                            <option value="0" selected="selected">জেলা নির্বাচন করুন</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row disAll" id="divthn">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">থানা নির্বাচন করুন<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <select id="thanaId" name="thanaId" class="form-control">
                                            <option value="0" selected="selected">থানা নির্বাচন করুন</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">ইউজার আইডি<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="Name" placeholder="ইউজার আইডি" name="Name" onchange="DuplicateUaserName()" data-parsley-required="true">
                                    </div>

                                </div>

                                <div class="form-group row">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">পাসওয়ার্ড<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="password" data-parsley-required="true" class="form-control " id="exampleInputPassword" placeholder="পাসওয়ার্ড" name="Password">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="reqNo" class="col-sm-3 col-form-label float-right">পুনরাবৃত্তি পাসওয়ার্ড<span style="color:red;">*</span></label>
                                    <div class="col-sm-8">
                                        <input type="password" data-parsley-required="true" class="form-control " id="exampleRepeatPassword" placeholder="পুনরাবৃত্তি পাসওয়ার্ড" name="ConfirmPassword">

                                    </div>
                                </div>
                                @*<div class="row">
            <div class="col-md-7">

            </div>
            <div class="col-md-4 pull-right">
                <button type="button" id="submit" class="btn btn-info btn-block" onclick="SaveUser()">অ্যাকাউন্ট নিবন্ধন করুন</button>
            </div>
            <div class="col-md-1">
            </div>
        </div>*@
                                <div class="form-group row">
                                    <div class="col-md-3">

                                    </div>
                                    <div class="col-md-8 ">
                                        <button type="button" id="submit" class="btn btn-info btn-block" onclick="SaveUser()">অ্যাকাউন্ট নিবন্ধন করুন</button>
                                    </div>
                                    <div class="col-md-1">
                                    </div>
                                </div>
                                <br>

                            </div>
                            <div class="col-2">

                            </div>
                        </div>
                    </from>


                </div>
            </div>
        </div>
    </div>

</form>
@section Scripts{
    <script>
        $(document).ready(function () {
            $('.disAll').hide();
           
            $('#RoleId').change(function () {
               // $('.disAll').hide();
                var role = $('#RoleId').val();
                var roleName = $('#RoleId :selected').text();
                $('#RoleName').val(roleName);
                //SbAdmin
                if (role == 'a3b6f86f-f910-4387-b579-041e4b8a1792') {
                    $('.disAll').hide();
                    $('#divDealer').hide();
                    $('#divShootingClub').hide();
                }
              
             
                      //District General User
                else if (role == '8211f581-a71e-4fc9-b5df-12b84d6aeec9') {
                    $('.disAll').show();
                    $('#divthn').hide();
                    $('#divDealer').hide();
                    $('#divShootingClub').hide();
                }
                    //Dealer
                else if (role == '9ae09ccf-6fd3-4b36-aabb-95324e13485c') {
                    $('.disAll').show();
                    $('#divDealer').show();
                    $('#divShootingClub').hide();
                    //$('#divthn').hide();
                }
                    //Dealer User
                else if (role == '5774a0e1-f858-4d82-a29a-5b9b0e003afc') {
                    $('.disAll').show();
                    $('#divDealer').show();
                    $('#divShootingClub').hide();
                    //$('#divthn').hide();
                }
                 
                    //Admin
                else if (role == '04AED4C4-EF8F-4704-9EC5-0B38CAAACBEB') {
                    $('.disAll').hide();
                    $('#divDealer').hide();
                    $('#divShootingClub').hide();
                   
                }
                  
                else {
                    $('.disAll').show();
                    $('#divDealer').hide();
                    $('#divShootingClub').hide();
                }
            })
            
            $('#divisionId').change(function () {
                var id = $('#divisionId').val();
                DisplayDiv(id);
            })
            $('#districtId').change(function () {
                var id = $('#districtId').val();
                DisplayDis(id);
            })
        })
        function SaveUser() {
                var role = $('#RoleId').val()
                var dist = $('#districtId').val()
                //if (role == 'SbAdmin') {
                //    if (dist == 0) {
                //        swal('warning', 'Please Select District!', 'warning');
                //        return false;
                //    }
                //}
                //else if (role == 'DCAdmin') {
                //    if (dist == 0) {
                //        swal('warning', 'Please Select District!', 'warning');
                //        return false;
                //    }
                //}
		        console.log($('#FormId').serializeArray());
		        var data = $('#FormId').serializeArray();
                 var form = $('#FormId');
                 console.log(data[0].value)
                 if (form.parsley().isValid()) {
                     swal({
                         title: 'Are you sure?', text: 'Do you want to submit this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, submit it!'
                     }).then(function () {
                         //$('#submit').submit();
                         $.ajax({
                             url: '@Url.Action("CreateUser", "Account")',
                             type: 'POST',
                             data: data
                         }).done(function () {

                             swal('success', 'Saved Successfully!', 'success').then(function () {
                                 //location.reload();
                                 location.replace("/Auth/Account/UserList");

                             });
                         }).fail(function () {
                             swal('warning', 'Failed!', 'warning');
                         })
                     });
                 }
                 else {
                     swal('warning', 'Please input mandatory field!', 'warning')
                 }
            
        }
        function DisplayDiv(id) {
            //alert(id);
            Common.Ajax('GET', '/global/api/GetAllDistrictByDivisionId/' + id, [], 'json', ajaxDistrict);
        }
        function DisplayDis(id) {
            Common.Ajax('GET', '/global/api/GetThanaByDistrictId/' + id, [], 'json', ajaxThana);
        }

        function ajaxDistrict(response) {
            $('#thanaId').val(0);
            //var options = '<option value="0">Select</option>';
            var options = '<option value="0">জেলা নির্বাচন করুন</option>';
            $.each(response, function (i, item) {
                options += '<option value="' + item.Id + '">' + item.districtNameBn + '</option>';
            });
            $('#districtId').empty();
            $('#districtId').append(options);
        }
        function ajaxThana(response) {
            //var options = '<option value="0">Select</option>';
            var options = '<option value="0">থানা নির্বাচন করুন</option>';
            $.each(response, function (i, item) {
                options += '<option value="' + item.Id + '">' + item.thanaNameBn + '</option>';
            });
            $('#thanaId').empty();
            $('#thanaId').append(options);
        }
        function DuplicateUaserName() {
            //alert(121);
            var uName = $("#Name").val()
            $.ajax({
                type: 'GET',
                url: '/Auth/Account/RestrictDuplicateUserName',
                data: {'uName':uName},
                datatType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    if (data !== 'Not Used') {
                        //$("#Name").val('');
                        swal('Warning', data + ' User Name has already used!', 'warning');
                        $("#Name").val('');
                        return false;
                    }
                },
                error: function (data) {
                    swal('Warning', data + ' User Name has already used!', 'warning');
                    $("#Name").val('');
                    return false;
                }
            })
        }
        function DuplicateEmail() {
            var uName = $("#Email").val()
            $.ajax({
                type: 'GET',
                url: '/Auth/Account/RestrictDuplicateEmail',
                data: { 'email': uName },
                datatType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    if (data !== 'Not Used') {
                        swal('Warning', data + ' Email has already used!', 'warning');
                        $("#Email").val("");
                        return false;
                    }
                }
            })
        }


    </script>
}