@model FADMS.Areas.FAMSDEALER.Models.SupplierViewModel
@{
    ViewData["Title"] = "Address";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="col-md-12 mb-0 pb-0" style="width:98%">
    <div class="card-header border" style="background-color:#F7F7F7;margin-left: 6px;">
        <h4 class="font-weight-bold;margin-left: -21px;">
            ঠিকানা  তথ্য 
            <a class='btn btn-outline-info float-right mr-4 mb-0' style="" data-toggle='tooltip' title='Go Back' href="/FAMSDEALER/Supplier/SupplierMenu/@ViewBag.SupplierId"><i class="fas fa-backward"></i></a>
        </h4>
    </div>
</div>

<div class="card-header border" style="background-color: #F8F9FC; width:95%;margin-top:20px;margin-left:20px">
    <div class="col-md-12">
        <h5 class="card-title" style="color: black; margin: 0; text-transform: uppercase;">
            তৈরি করুন 
            <a class="float-right btn btn-sm btn-info" href="/FAMSDEALER/Supplier/AddressFileUpload/@ViewBag.supplierId"><i class="fas fa-upload"></i> এক্সেল ফাইল আপলোড করুন </a>
        </h5>
    </div>
</div>

<div class="card" style="width:95%; margin-left:20px">
    <div class="col-12">
        <div class="card-body">
            <form asp-area="FAMSDEALER" id="fromInfo" asp-controller="Suppler" asp-action="Address" method="post" data-parsley-validate="parsley">

                <div asp-validation-summary="All" class="text-danger"></div>
                <input type="hidden" name="SupplierId" id="SupplierId" value="@ViewBag.SupplierId" />
                <input type="hidden" name="supplierAddressId" id="supplierAddressId" value="" />


                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="type" class="col-sm-4 col-form-label">ঠিকানা ধরন </label>
                            <div class="col-sm-8">
                                <select type="text" class="form-control" id="type" value="" name="type">
                                    <option selected>নির্বাচন করুন </option>
                                    <option>বর্তমান </option>
                                    <option>স্থায়ী </option>
                                    <option>প্রাতিষ্ঠানিক </option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="presentHouseVillage" class="col-sm-4 col-form-label">বাড়ি নং </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="houseVillage" value="" name="houseVillage">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="presentArea" class="col-sm-4 col-form-label">এলাকা </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="union" value="" name="union">
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="presentBlockSector" class="col-sm-4 col-form-label">ব্লক / সেক্টর </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="blockSector" value="" name="blockSector">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="presentPostCode" class="col-sm-4 col-form-label">পোস্ট কোড</label>
                            <div class="col-sm-8">
                                <input data-parsley-type="number" data-parsley-length="[4, 6]" data-parsley-trigger="keyup" class="form-control" id="postCode" value="" name="postCode">
                            </div>
                        </div>
                    </div>
                    <div class="col-6">

                        <div class="form-group row">
                            <label for="presentPostOffice" class="col-sm-4 col-form-label">পোস্ট অফিস </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="postOffice" value="" name="postOffice">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="presentDivision" class="col-sm-4 col-form-label">বিভাগ <span style="color:red">*</span></label>
                            <div class="col-sm-8">
                                <select type="text" class="form-control" id="divisionId" name="divisionId" data-parsley-required="false">
                                    <option selected>নির্বাচন করুন </option>
                                    @foreach (var item in Model.divisions)
                                    {
                                        <option value="@item.Id">@item.divisionNameBn</option>
                                    }
                                </select>

                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="presentDistrict" class="col-sm-4 col-form-label">জেলা <span style="color:red">*</span></label>
                            <div class="col-sm-8">
                                <select type="text" class="form-control" id="districtId" value="" name="districtId" data-parsley-required="false">
                                    <option selected>নির্বাচন করুন </option>
                                </select>

                            </div>
                        </div>

                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="presentUpazila" class="col-sm-4 col-form-label">উপজেলা <span style="color:red">*</span></label>
                            <div class="col-sm-8">
                                <select type="text" class="form-control" id="thanaId" value="" name="thanaId" data-parsley-required="false">
                                    <option selected>নির্বাচন করুন </option>
                                </select>
                            </div>
                        </div>
                    </div>

                </div>

                <button type="button" id="submit" value="Submit" class="btn btn-success float-right"><i class="fas fa-save"></i></button>
                <button type="reset" onclick="Refresh()" class="btn btn-danger float-right mr-2"><i class="fas fa-sync"></i></button>
            </form>
        </div>
    </div>
    <br />

    <div class="col-12">
        <div class="card-header border" style="background-color:#F8F9FC;width:98%">
            <h4 class="m-0 font-weight-bold">ঠিকানা তালিকা</h4>
        </div>
    </div>

    <div class="col-12" style="width:98%">
        <div class="card ">
            <div class="card-body">
                <table class="table table-striped table-bordered table-sm" id="spouseTable">
                    <thead>
                        <tr>
                            <th>সিরিয়াল নং </th>
                            <th>ঠিকানা  ধরন </th>
                            <th>বাড়ি</th>
                            <th>ব্লক / সেক্টর </th>
                            <th>পোস্ট কোড</th>
                            <th>পোস্ট অফিস </th>
                            <th>বিভাগ </th>
                            <th>জেলা </th>
                            <th>উপজেলা</th>
                            <th>সম্পাদনা করুন </th>

                        </tr>
                    </thead>
                    <tbody>
                        @{
                            var i = 1;
                            @foreach (var data in Model.supplierAddresses)
                            {
                                <tr>
                                    <td>@i</td>
                                    <td>@data.type</td>
                                    <td>@data.houseVillage</td>
                                    <td>@data.blockSector</td>
                                    <td>@data.postCode</td>
                                    <td>@data.postOffice</td>
                                    <td>@data.division?.divisionName</td>
                                    <td>@data.district?.districtName</td>
                                    <td>@data.thana?.thanaName</td>

                                    <td>
                                        <a class="btn btn-success" onclick="UpdateAddress(@data.Id,'@data.type','@data.houseVillage','@data.union','@data.blockSector','@data.postCode','@data.postOffice','@data.divisionId','@data.districtId','@data.thanaId')" href="#"><i class="fa fa-edit"></i></a>
                                        <a class="btn btn-danger" onclick="Remove(@data.Id)" href="#"><i class="fa fa-trash-alt"></i></a>
                                    </td>
                                </tr>
                                i++;
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



@section Scripts{
    <script>

        $('#submit').click(function () {
       var data = $('#fromInfo').serializeArray();
		swal({
			title: 'Are you sure?', text: 'Do you want to submit this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, submit it!'
		}).then(function () {
			$.ajax({
                url: '/FAMSDEALER/Supplier/Address/'+@ViewBag.supplierId,
				type: 'POST',
				data: data
			}).done(function () {
                if (data[0].value == 0) {
                    swal('success', 'Saved Successfully!', 'success').then(function () {
                        location.reload();
                    });
                }
                else {
                    swal('success', 'Save Successfully!', 'success').then(function () {
                        location.reload();
                    });;
                }
			}).fail(function () {
				swal('warning', 'Failed!', 'warning');
			})
		});
	})



        $('#divisionId').on('change', function () {
            $("#districtId").html('');
            $.ajax({
                method: 'get',
                url: '/FAMSDEALER/Supplier/DistrictInfoList/' + this.value,
                success: function (res) {
                    var resData = res.districts;
                    $.each(resData, function (k, v) {
                        console.log(res.districts);
                        $("#districtId").append('<option value="' + v.Id + '">' + v.districtNameBn + '</option>')
                    })
                }
            })

        })

        $('#districtId').on('change', function () {
            $("#thanaId").html('');
            $.ajax({
                method: 'get',
                url: '/FAMSDEALER/Supplier/ThanaInfoList/' + this.value,
                success: function (res) {
                    var resData = res.thanas;
                    $.each(resData, function (k, v) {

                        $("#thanaId").append('<option value="' + v.Id + '">' + v.thanaNameBn + '</option>')
                    })
                }
            })

        })


        $(document).ready(function () {
            $('#spouseTable').DataTable();

        })
        function UpdateAddress(Id, type, houseVillage, union, blockSector, postCode, postOffice, divisionId, districtId, thanaId) {
            $('#supplierAddressId').val(Id);
            $('#type').val(type);
            $('#houseVillage').val(houseVillage);
            $('#union').val(union);
            $('#blockSector').val(blockSector);
            $('#postCode').val(postCode);
            $('#postOffice').val(postOffice);
            $('#divisionId').val(divisionId);

            Common.Ajax('GET', '/FAMSDEALER/Supplier/DistrictInfoList/' + divisionId, [], 'json', ajaxDistrict, false);
            $('#districtId').val(districtId);

            Common.Ajax('GET', '/FAMSDEALER/Supplier/ThanaInfoList/' + districtId, [], 'json', ajaxThana, false);
            $('#thanaId').val(thanaId);
        }

        function ajaxDistrict(response) {
            $('#districtId').empty();
            $.each(response.districts, function (i, v) {
                $("#districtId").append('<option value="' + v.Id + '">' + v.districtNameBn + '</option>')
            });
        }

        function ajaxThana(response) {
            $('#thanaId').empty();
            $.each(response.thanas, function (i, v) {
                $("#thanaId").append('<option value="' + v.Id + '">' + v.thanaNameBn + '</option>')
            });
        }

        function Refresh() {
            $('#supplierAddressId').val('');
            $('#type').val('');
            $('#houseVillage').val('');
            $('#union').val('');
            $('#blockSector').val('');
            $('#postCode').val('');
            $('#postOffice').val('');
            $('#divisionId').val('');
            $('#districtId').val('');
            $('#thanaId').val('');
        }

    </script>
}
